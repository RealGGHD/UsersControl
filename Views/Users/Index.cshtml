@model Task4.Models.UsersViewModel

@{
    ViewBag.Title = "Users";
}

<div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center mb-3 gap-2">
    <div class="d-flex align-items-center gap-2">
        <h1 class="m-0">Users</h1>
    </div>

    <div class="d-flex flex-wrap align-items-center gap-2 mt-2 mt-sm-0">
        <button id="theme-toggle" class="btn btn-outline-secondary btn-sm" aria-pressed="false" aria-label="Toggle theme">🌙 Dark Mode</button>

        <form asp-controller="Account" asp-action="Logout" method="post" class="mb-0">
            <button type="submit" class="btn btn-danger btn-sm">Logout</button>
        </form>
    </div>
</div>

@if (TempData["Message"] != null)
{
    <div class="alert alert-success" role="alert">@TempData["Message"]</div>
}

<form method="post" id="userForm" asp-controller="Users">
    @Html.AntiForgeryToken()

    <div class="mb-2 d-flex justify-content-between align-items-center flex-wrap gap-2">
        <div>
            <input type="checkbox" id="selectAll" aria-label="Select all users" />
            <label for="selectAll" class="mb-0">Select all</label>
        </div>

        <div class="btn-group" role="group" aria-label="User actions">
            <button type="submit" formaction="/Users/Block" class="btn btn-outline-warning">
                <i class="bi bi-slash-circle"></i> Block
            </button>
            <button type="submit" formaction="/Users/Unblock" class="btn btn-outline-secondary">
                <i class="bi bi-unlock"></i> Unblock
            </button>
            <button type="submit" formaction="/Users/Delete" class="btn btn-outline-danger">
                <i class="bi bi-trash"></i> Delete
            </button>
        </div>
    </div>

    <div class="table-responsive rounded-3">
        <table id="users-table" class="table table-bordered table-hover mb-0">
            <thead>
                <tr>
                    <th class="text-center p-0" style="width: 30px;"></th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Last login</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model.Users)
                {
                    var isCurrent = user.Id == Model.CurrentUserId;
                    <tr class="@(isCurrent ? "highlight-row table-primary" : "")">
                        <td class="text-center">
                            <input type="checkbox" name="selectedIds" value="@user.Id" aria-label="Select user @user.Name" />
                        </td>
                        <td>@user.Name</td>
                        <td>@user.Email</td>
                        <td>@user.LastLoginTime?.ToString("g")</td>
                        <td>@user.Status</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</form>

@section Styles {
    <link rel="stylesheet" href="~/css/users.css" />
}

@section Scripts {
    <script src="~/js/users.js"></script>
}
